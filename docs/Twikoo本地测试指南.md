# Twikoo 评论系统本地测试指南

## 前置条件

✅ 已配置环境变量 `VITE_TWIKOO_ENV_ID`  
✅ 开发服务器已启动（`npm run dev`）  
✅ Twikoo 后端服务正常运行

## 测试步骤

### 1. 启动开发服务器

如果还没有启动，在 `frontend` 目录下运行：

```bash
npm run dev
```

服务器通常会在 `http://localhost:3000` 启动。

### 2. 访问详情页

打开浏览器，访问以下任意一个详情页：

**事件详情页示例：**
- `http://localhost:3000/detail/event/1`
- `http://localhost:3000/detail/event/2`
- 等等...

**人物详情页示例：**
- `http://localhost:3000/detail/person/1`
- `http://localhost:3000/detail/person/2`
- 等等...

### 3. 检查评论区域

在详情页底部，应该能看到：

1. **评论标题**：显示"评论"标题和图标
2. **加载状态**：如果正在加载，会显示"正在加载评论..."的加载动画
3. **评论输入框**：如果加载成功，应该能看到 Twikoo 的评论输入界面

### 4. 测试评论功能

1. **填写评论信息**：
   - 昵称
   - 邮箱（可选）
   - 网站（可选）
   - 评论内容

2. **提交评论**：
   - 点击"提交"按钮
   - 评论应该会显示在页面上

3. **测试回复功能**：
   - 点击已有评论的"回复"按钮
   - 填写回复内容并提交

### 5. 检查浏览器控制台

打开浏览器开发者工具（F12），检查：

- **Console 标签**：
  - 应该没有错误信息
  - 如果有警告，检查是否是预期的（如环境变量未配置的警告）

- **Network 标签**：
  - 检查是否有对 Twikoo 后端的请求
  - 请求应该返回 200 状态码

## 常见问题排查

### 问题 1: 评论区域不显示

**可能原因：**
- 环境变量未配置
- 数据未加载完成

**解决方法：**
1. 检查 `.env` 文件中是否有 `VITE_TWIKOO_ENV_ID`
2. 检查浏览器控制台是否有错误
3. 确认详情页数据已加载完成（页面内容已显示）

### 问题 2: 显示"Twikoo 环境 ID 未配置"

**解决方法：**
1. 在 `frontend/.env` 文件中添加：
   ```env
   VITE_TWIKOO_ENV_ID=https://your-twikoo-backend-url
   ```
2. 重启开发服务器（`npm run dev`）

### 问题 3: 显示"Twikoo 脚本加载失败"

**可能原因：**
- 网络连接问题
- CDN 访问受限

**解决方法：**
1. 检查网络连接
2. 尝试使用 VPN 或代理
3. 检查防火墙设置

### 问题 4: 显示"Twikoo 初始化失败"

**可能原因：**
- Twikoo 后端服务未运行
- 环境 ID 配置错误
- 后端服务地址不正确

**解决方法：**
1. 检查 Twikoo 后端服务是否正常运行
2. 访问后端服务地址，确认可以访问
3. 检查环境变量中的 URL 是否正确
4. 确认后端服务支持 CORS（跨域请求）

### 问题 5: 评论提交失败

**可能原因：**
- 后端服务未正确配置
- 网络问题
- 后端服务限制

**解决方法：**
1. 检查浏览器控制台的网络请求
2. 查看请求是否成功发送到后端
3. 检查后端服务的日志
4. 确认后端服务已正确部署和配置

## 测试检查清单

- [ ] 开发服务器已启动
- [ ] 环境变量已配置
- [ ] 可以访问详情页
- [ ] 评论区域显示正常
- [ ] 没有控制台错误
- [ ] 可以提交评论
- [ ] 评论可以正常显示
- [ ] 可以回复评论
- [ ] 不同页面的评论是独立的

## 测试不同场景

### 场景 1: 事件详情页评论
1. 访问 `/detail/event/1`
2. 提交一条评论
3. 刷新页面，评论应该还在

### 场景 2: 人物详情页评论
1. 访问 `/detail/person/1`
2. 提交一条评论
3. 刷新页面，评论应该还在

### 场景 3: 不同页面的评论独立性
1. 在事件详情页提交评论 A
2. 在人物详情页提交评论 B
3. 切换回事件详情页，应该只看到评论 A
4. 切换回人物详情页，应该只看到评论 B

### 场景 4: 评论回复
1. 提交一条评论
2. 点击"回复"按钮
3. 填写回复内容并提交
4. 回复应该显示在原评论下方

## 调试技巧

### 查看环境变量

在浏览器控制台运行：

```javascript
console.log('Twikoo Env ID:', import.meta.env.VITE_TWIKOO_ENV_ID)
```

### 检查 Twikoo 对象

在浏览器控制台运行：

```javascript
console.log('Twikoo:', window.twikoo)
```

### 手动初始化 Twikoo

如果需要手动测试，可以在浏览器控制台运行：

```javascript
window.twikoo.init({
  envId: 'your-env-id',
  el: '#twikoo-comment-container',
  path: window.location.pathname,
  lang: 'zh-CN'
})
```

## 下一步

测试通过后，可以：

1. **部署到生产环境**：
   - 在 GitHub 仓库变量中设置 `VITE_TWIKOO_ENV_ID`
   - 触发 GitHub Actions 部署

2. **配置评论审核**：
   - 在 Twikoo 管理后台启用评论审核
   - 配置邮件通知

3. **自定义样式**：
   - 根据需要调整评论区域的样式
   - 参考 Twikoo 官方文档

## 相关链接

- [Twikoo 官方文档](https://twikoo.js.org/intro)
- [Twikoo GitHub 仓库](https://github.com/imaegoo/twikoo)
- [项目配置指南](./Twikoo评论系统配置指南.md)

