# 静态部署文档

## 一、部署方案概述

本项目采用**全静态部署**方案，所有数据存储在 JSON 文件中，前端直接读取静态数据，无需后端服务器。更新内容时，修改 JSON 文件后重新构建和部署即可。

### 优势
- ✅ 完全免费（GitHub Pages、Vercel、Netlify 等）
- ✅ 访问速度快（CDN 加速）
- ✅ 无需维护服务器
- ✅ 安全性高（无后端攻击面）
- ✅ 易于扩展（静态文件可无限扩展）

### 适用场景
- 内容更新频率不高（可接受重新部署）
- 数据量适中（JSON 文件大小合理）
- 不需要实时交互功能

## 二、支持的部署平台

### 2.1 GitHub Pages
**免费，适合开源项目**

1. 在 GitHub 创建仓库
2. 推送代码到仓库
3. 在仓库设置中启用 GitHub Pages
4. 选择 `gh-pages` 分支或 `main` 分支的 `/docs` 目录

**自动部署脚本：**
```bash
# 安装 gh-pages
npm install --save-dev gh-pages

# package.json 添加脚本
"scripts": {
  "deploy": "npm run build && gh-pages -d dist"
}
```

### 2.2 Vercel
**免费，自动部署，推荐**

1. 注册 Vercel 账号
2. 导入 GitHub 仓库
3. 自动检测并部署
4. 每次 push 代码自动重新部署

**配置 `vercel.json`：**
```json
{
  "buildCommand": "cd frontend && npm install && npm run build",
  "outputDirectory": "frontend/dist",
  "routes": [
    {
      "src": "/(.*)",
      "dest": "/index.html"
    }
  ]
}
```

### 2.3 Netlify
**免费，功能丰富**

1. 注册 Netlify 账号
2. 连接 GitHub 仓库
3. 配置构建命令：`cd frontend && npm install && npm run build`
4. 配置发布目录：`frontend/dist`

**配置 `netlify.toml`：**
```toml
[build]
  command = "cd frontend && npm install && npm run build"
  publish = "frontend/dist"

[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
```

### 2.4 阿里云 OSS / 腾讯云 COS
**国内访问快，需要配置 CDN**

1. 创建 OSS/COS 存储桶
2. 配置静态网站托管
3. 上传构建后的文件
4. 配置 CDN 加速

## 三、数据更新流程

### 3.1 更新数据文件

数据文件位于 `frontend/public/data/` 目录：

```
frontend/public/data/
├── dynasties.json      # 朝代数据
├── events.json         # 事件数据
├── persons.json        # 人物数据
├── relationships.json  # 关系数据
└── sources.json        # 来源数据
```

### 3.2 数据格式规范

#### 事件数据 (events.json)
```json
{
  "id": 1,
  "title": "事件标题",
  "description": "事件描述",
  "eventYear": -221,
  "eventType": "political",
  "dynastyId": 1,
  "location": "地点",
  "persons": [1, 2],
  "sources": [1, 2]
}
```

#### 人物数据 (persons.json)
```json
{
  "id": 1,
  "name": "人物姓名",
  "nameVariants": ["别名1", "别名2"],
  "birthYear": -259,
  "deathYear": -210,
  "biography": "人物简介",
  "personType": ["politician", "military"],
  "dynastyId": 1,
  "sources": [1]
}
```

### 3.3 更新步骤

1. **编辑 JSON 文件**
   - 在本地编辑 `frontend/public/data/*.json` 文件
   - 确保 JSON 格式正确

2. **本地测试**
   ```bash
   cd frontend
   npm install
   npm run dev
   ```
   - 访问 http://localhost:3000 测试

3. **构建项目**
   ```bash
   cd frontend
   npm run build
   ```

4. **部署**
   - **GitHub Pages**: `npm run deploy`
   - **Vercel/Netlify**: 推送到 GitHub，自动部署
   - **OSS/COS**: 上传 `dist` 目录内容

## 四、建议提交功能

### 4.1 方案一：使用 Formspree（推荐）

Formspree 提供免费的表单提交服务，无需后端。

1. 注册 Formspree：https://formspree.io
2. 创建表单，获取表单 ID
3. 修改 `frontend/src/pages/Suggestion/index.tsx`：

```typescript
const onFinish = async (values: any) => {
  try {
    await fetch('https://formspree.io/f/YOUR_FORM_ID', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(values),
    })
    message.success('建议提交成功！')
  } catch (error) {
    message.error('提交失败，请稍后重试。')
  }
}
```

### 4.2 方案二：使用 EmailJS

EmailJS 可以将表单数据发送到邮箱。

1. 注册 EmailJS：https://www.emailjs.com
2. 配置邮件模板
3. 集成到前端代码

### 4.3 方案三：GitHub Issues

将建议提交到 GitHub Issues，管理员审核后更新数据。

## 五、性能优化

### 5.1 代码分割
- 路由级别的代码分割（已配置）
- 组件懒加载

### 5.2 数据优化
- 按需加载数据
- 数据缓存（已实现）
- 压缩 JSON 文件（生产环境）

### 5.3 图片优化
- 使用 WebP 格式
- 图片懒加载
- CDN 加速

### 5.4 构建优化
```json
// vite.config.ts
export default defineConfig({
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          'vis-timeline': ['vis-timeline'],
          'vis-network': ['vis-network'],
        },
      },
    },
  },
})
```

## 六、CI/CD 自动化

### 6.1 GitHub Actions

创建 `.github/workflows/deploy.yml`：

```yaml
name: Deploy to GitHub Pages

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '18'
      - run: cd frontend && npm install
      - run: cd frontend && npm run build
      - uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./frontend/dist
```

## 七、域名配置

### 7.1 自定义域名

1. **GitHub Pages**
   - 在仓库设置中添加自定义域名
   - 配置 DNS CNAME 记录

2. **Vercel**
   - 在项目设置中添加域名
   - 自动配置 SSL 证书

3. **Netlify**
   - 在域名设置中添加自定义域名
   - 自动配置 SSL 证书

## 八、监控和分析

### 8.1 访问统计

- **Google Analytics**: 添加 GA 跟踪代码
- **百度统计**: 国内访问统计
- **Vercel Analytics**: Vercel 内置分析

### 8.2 错误监控

- **Sentry**: 前端错误监控
- **LogRocket**: 用户行为记录

## 九、备份策略

### 9.1 数据备份

1. **Git 版本控制**: 所有数据文件纳入 Git
2. **定期导出**: 定期导出 JSON 文件备份
3. **多平台部署**: 同时部署到多个平台

### 9.2 恢复流程

1. 从 Git 历史恢复数据文件
2. 重新构建和部署
3. 验证数据完整性

## 十、常见问题

### Q: 数据文件太大怎么办？
A: 
- 使用数据分片（按朝代或时间段分割）
- 实现按需加载
- 使用压缩算法

### Q: 如何实现搜索功能？
A: 
- 使用客户端全文搜索（如 Fuse.js）
- 预生成搜索索引
- 使用 Algolia 等第三方搜索服务

### Q: 如何实现用户认证？
A: 
- 静态站点不支持传统认证
- 可以使用 Auth0、Firebase Auth 等第三方服务
- 或使用 JWT + 静态密钥（安全性较低）

### Q: 如何更新大量数据？
A: 
- 编写脚本批量更新 JSON 文件
- 使用 Excel/CSV 导入工具
- 开发简单的数据管理界面（本地运行）

