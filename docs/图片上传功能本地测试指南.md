# 图片上传功能本地测试指南

## 前置条件

✅ 开发服务器已启动（`npm run dev`）  
✅ 浏览器可以访问 `http://localhost:3000`  
✅ Netlify 图片上传服务已部署（`https://cms-images.netlify.app/`）

## 测试步骤

### 1. 启动开发服务器

如果还没有启动，在 `frontend` 目录下运行：

```bash
cd frontend
npm run dev
```

服务器通常会在 `http://localhost:3000` 启动。

### 2. 访问建议页面

打开浏览器，访问：
```
http://localhost:3000/suggestion
```

### 3. 测试图片上传

1. **填写建议表单**：
   - 选择建议类型
   - 填写标题
   - 填写详细描述
   - 填写时间

2. **上传图片**：
   - 找到"附加图片（可选）"字段
   - 点击"上传图片"按钮
   - 选择一张图片文件（JPG 或 PNG 格式，小于 5MB）
   - 观察上传进度

3. **检查上传结果**：
   - 上传成功后，图片应该显示在预览区域
   - 如果上传失败，会显示错误提示

4. **提交建议**：
   - 填写完整表单后，点击"提交建议"
   - 在提交后的详情中，应该能看到上传的图片

### 4. 检查浏览器控制台

打开浏览器开发者工具（F12），检查：

- **Console 标签**：
  - 查看是否有错误信息
  - 查看上传请求的日志

- **Network 标签**：
  - 查找对 `cms-images.netlify.app` 的请求
  - 检查请求状态码和响应内容

## 常见问题排查

### 问题 1: 图片上传失败，显示 500 错误

**可能原因：**
- Netlify 函数的 GitHub Token 未配置或无效
- GitHub 仓库权限不足

**解决方法：**
1. 检查 Netlify 环境变量配置
2. 确保 GitHub Token 有仓库写入权限
3. 联系管理员检查后端服务配置

### 问题 2: 图片上传成功但无法显示

**可能原因：**
- jsDelivr CDN 链接格式不正确
- 图片文件路径错误

**解决方法：**
1. 检查返回的 URL 格式
2. 在浏览器中直接访问图片 URL
3. 检查 GitHub 仓库中是否确实存在该文件

### 问题 3: 上传按钮无响应

**可能原因：**
- 文件格式不支持
- 文件大小超过限制

**解决方法：**
1. 确保文件格式为 JPG 或 PNG
2. 确保文件大小小于 5MB
3. 检查浏览器控制台错误信息

### 问题 4: 图片上传后无法删除

**解决方法：**
1. 点击图片右上角的删除按钮
2. 检查图片列表是否正确更新

## 测试检查清单

- [ ] 可以成功选择图片文件
- [ ] 图片上传过程中显示加载状态
- [ ] 上传成功后显示图片预览
- [ ] 可以删除已上传的图片
- [ ] 提交建议后，图片显示在详情中
- [ ] 在建议列表页面可以查看图片
- [ ] 图片可以点击放大查看

## API 测试

如果需要直接测试 API，可以使用以下命令：

```bash
cd frontend
node test-image-upload.mjs
```

这会发送一个测试请求到 Netlify 函数，并显示响应结果。

## 注意事项

1. **文件大小限制**：单张图片不超过 5MB
2. **文件格式**：仅支持 JPG 和 PNG
3. **上传数量**：最多上传 5 张图片
4. **网络要求**：需要能够访问 `cms-images.netlify.app`
5. **GitHub Token**：后端服务需要配置有效的 GitHub Token

## 下一步

如果本地测试成功，可以：
1. 部署到生产环境
2. 在真实环境中测试
3. 收集用户反馈

